name: Test4
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Get Repo List
        id: repo
        uses: yi-Xu-0100/repo-list-generator@v1.1.1
        with:
          my_token: ${{ secrets.SCORE_TS }}
          user: 'laiyoufafa'
          # (default)max_page: 10
          # (default)block_list:
          # (default)allow_empty: false
          # (default)allow_archived: true
          
      # /home/runner/work/ScoreCardActionForOpenHarmony/ScoreCardActionForOpenHarmony
      # - name: current PATH
      #  run: pwd
     
          
      - name: Get Scorecard
        run: |
          wget https://github.com/ossf/scorecard/releases/download/v4.10.5/scorecard_4.10.5_linux_amd64.tar.gz
          tar -zxvf scorecard_4.10.5_linux_amd64.tar.gz
          mv scorecard-linux-amd64 scorecard
          
          
      - name: Score Repositroies
        run: |
          # 将scorecard加入环境变量
          export PATH=$PATH:$GITHUB_WORKSPACE
          
          # 将仓库列表变成数组格式
          repos=${{steps.repo.outputs.repoList_ALL}}
          arr=(${repos//,/ })
          length=${#arr[@]}

          #计数器
          count=0
          {
            for((i=0;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN1}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    echo "name:first  ${repoName} finished"
                    sleep 5s
              fi
            done
          }&
          {
            for((i=1;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN2}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    echo "name:first  ${repoName} finished"
                    sleep 5s
              fi
            done
          }&
          {
            for((i=2;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN3}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    echo "name:first  ${repoName} finished"
                    sleep 5s
              fi
            done
          }&
          {
            for((i=3;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN4}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    echo "name:first  ${repoName} finished"
                    sleep 5s
              fi
            done
          }&
          {
            for((i=4;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN5}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    sleep 5s
                    echo "name:first  ${repoName} finished"
              fi
            done
          }&
          {
            for((i=5;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN6}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    echo "name:first  ${repoName} finished"
                    sleep 5s
              fi
            done
          }&
          {
            for((i=6;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN7}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    echo "name:first  ${repoName} finished"
                    sleep 5s
              fi
            done
          }&
          {
            for((i=7;i<length;i=i+8));do
              count=$(($count+1));
              echo "count value :${count}"
              if [ $i -lt $length ];then
                    export GITHUB_AUTH_TOKEN=${{ secrets.GH_TOKEN8}}
                    repoName=https://github.com/laiyoufafa/${arr[$i]}
                    echo "time:${i}    repos_url:${repoName} "
                    str=""
                    str=$(scorecard --repo $repoName --format json) || true
                    echo $str
                    echo "name:first  ${repoName} finished"
                    sleep 5s
              fi
            done
          }&
                    
          
          wait
          echo "finished"
         

